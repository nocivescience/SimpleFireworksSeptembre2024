<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.3/p5.min.js"
        integrity="sha512-0zGLOFv/+OQ6YfVCSGDQWhrDRx0ONmBqWvs3gI4olm8i6xtKoG1FhEnB4eTaWCVnojyfUDgE8Izeln+mAJAkFA=="
        crossorigin="anonymous" referrerpolicy="no-referrer">
        </script>
    <script>

        class Particle {
            constructor(x, y, velocity, color, exploded) {
                this.pos = createVector(x, y);
                this.vel = velocity;
                this.acc = createVector(0, 0);
                this.lifespan = 255;
                this.color = color;
                this.exploded = exploded;
            }

            applyForce(force) {
                this.acc.add(force);
            }

            update() {
                this.vel.add(this.acc);
                this.pos.add(this.vel);
                this.acc.mult(0);  // Reset acceleration after each update
                this.lifespan -= 4; // Decrease lifespan for fade effect
            }

            done() {
                return this.lifespan <= 0;
            }

            show() {
                stroke(this.color);
                strokeWeight(2);
                fill(this.color, this.lifespan);
                ellipse(this.pos.x, this.pos.y, 10);
            }
        }


        // Inspiration: CC 27: Fireworks by Daniel Shiffman
        // https://editor.p5js.org/codingtrain/sketches/O2M0SO-WO

        // Soundpack via jnsjknn

        const particles = [];
        const fireworks = [];
        let initPos;
        let launchPos;
        let vel;
        let col;
        let launching = false;
        let l1, e1, e2;
        let prompt = 'drag the pod to launch your firework';

        // function preload() {
        //     l1 = loadSound("sound/l1.mp3");
        //     e1 = loadSound("sound/e1.mp3");
        //     e2 = loadSound("sound/e2.mp3");
        // }

        function setup() {
            createCanvas(800, 400);
            textFont('Georgia');
            textSize(14);
            initPos = createVector(width / 2, height - 100);
            col = color(255);
        }

        function draw() {
            background(0, 0, 0, 25);

            // l1.setVolume(0.01);
            // e1.setVolume(0.15);
            // e2.setVolume(0.15);

            stroke(255);
            line(width / 2 - 20, height - 100, width / 2 - 20, height);
            line(width / 2 + 20, height - 100, width / 2 + 20, height);

            // check the launch status to show different launchpad shape
            if (mouseIsPressed) {
                constrainedY = constrain(mouseY, 100, height * 2);
                line(width / 2 - 20, height - 100, mouseX, constrainedY);
                line(width / 2 + 20, height - 100, mouseX, constrainedY);
                ellipse(mouseX, constrainedY, 10);
            }
            else if (!launching) {
                line(width / 2 - 20, height - 100, width / 2 + 20, height - 100);
                ellipse(width / 2, height - 100, 10);
            }

            noStroke();

            // update and show the status of the particles
            for (let i = 0; i < particles.length; i++) {
                particles[i].update();
                particles[i].show();
                if (particles[i].done()) particles.splice(i, 1);
                // allow next launch if
                if (launching && !mouseIsPressed && particles[particles.length - 1].pos.y < height - 100) launching = false;
            }

            // update and show the status of the fireworks
            for (let i = 0; i < fireworks.length; i++) {
                fireworks[i].update();
                fireworks[i].show();
                if (fireworks[i].done()) fireworks.splice(i, 1);
            }

            // show the prompt
            fill(255);
            text(prompt, width / 2 + 40, height - 20);
        }

        // initiate the launch while pressed
        function mousePressed() {
            if (!launching) launching = true;
        }

        // start the launch processes and initiate the particle
        function mouseReleased() {
            constrainedY = constrain(mouseY, 100, height * 2);
            launchPos = createVector(mouseX, constrainedY);
            vel = p5.Vector.sub(initPos, launchPos);
            vel.mult(0.1);
            // l1.play();
            particles.push(new Particle(mouseX, constrainedY, vel, col, false));
        }

    </script>
</body>

</html>